<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://unpkg.com/gojs@3.0.10/release/go.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
</head>

<body>
    <div id="allSampleContent" class="p-4 w-full">
        <script id="code">
            function init() {
                var myDiagram = new go.Diagram('myDiagramDiv', {
                    initialContentAlignment: go.Spot.Left,
                    toolTipDuration: Infinity,
                    allowSelect: false,
                    layout: new go.TreeLayout({ arrangement: go.TreeArrangement.FixedRoots })
                });

                function buttonExpandCollapse(e, port) {
                    var node = port.part;
                    node.diagram.startTransaction('expand/collapse');
                    var portid = port.portId;

                    node.findLinksOutOf(portid).each((l) => {
                        var n = l.getOtherNode(node);
                        l.visible = !l.visible; // Toggle link visibility
                        n.visible = l.visible; // Toggle connected node visibility
                        if (n.visible) {
                            n.location = node.getDocumentPoint(go.Spot.Bottom); // Position the new node
                        }
                    });
                    myDiagram.toolManager.hideToolTip();
                    node.diagram.commitTransaction('expand/collapse');
                }

                // Define tooltips for buttons
                var tooltipTemplate = go.GraphObject.make('ToolTip',
                    go.GraphObject.make(go.TextBlock, {
                        font: '8pt Roboto, sans-serif',
                        wrap: go.TextBlock.WrapFit,
                        desiredSize: new go.Size(200, NaN),
                        alignment: go.Spot.Center,
                        margin: 6
                    },
                        new go.Binding('text', '', tooltipTextConverter))
                );

                // Define the Node template for non-leaf nodes
                myDiagram.nodeTemplateMap.add('decision',
                    go.GraphObject.make(go.Node, 'Auto',
                        go.GraphObject.make(go.Shape, 'Rectangle', { fill: 'whitesmoke', stroke: 'lightgray', desiredSize: new go.Size(300, 250) }),
                        go.GraphObject.make(go.Panel, 'Vertical', { defaultStretch: go.GraphObject.Fill },
                            go.GraphObject.make(go.TextBlock, { font: '16px Roboto, sans-serif', margin: 5 },
                                new go.Binding('text', 'title')),
                            go.GraphObject.make(go.Panel, 'Vertical', { defaultAlignment: go.Spot.Center, margin: 5 },
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'a'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'aText'))),
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'b'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'bText'))),
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'c'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'cText'))),
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'd'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'dText'))),
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'e'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'eText'))),
                                go.GraphObject.make('Button', { click: buttonExpandCollapse, toolTip: tooltipTemplate },
                                    new go.Binding('portId', 'f'),
                                    go.GraphObject.make(go.TextBlock, { font: '900 16px Roboto, sans-serif' },
                                        new go.Binding('text', 'fText')))
                            )
                        )
                    )
                );

                // Define the Node template for leaf nodes
                myDiagram.nodeTemplateMap.add('personality',
                    go.GraphObject.make(go.Node, 'Auto',
                        go.GraphObject.make(go.Shape, 'Rectangle', { fill: 'whitesmoke', stroke: 'lightgray' }),
                        go.GraphObject.make(go.TextBlock, {
                            font: '13px Roboto, sans-serif',
                            wrap: go.TextBlock.WrapFit,
                            desiredSize: new go.Size(200, NaN),
                            margin: 5
                        },
                            new go.Binding('text', 'text'))
                    )
                );

                // Define the only Link template
                myDiagram.linkTemplate = go.GraphObject.make(go.Link, { routing: go.Link.Orthogonal, fromPortId: '' },
                    new go.Binding('fromPortId', 'fromport'),
                    go.GraphObject.make(go.Shape, { stroke: 'lightblue', strokeWidth: 2 })
                );

                // Create the model for the decision tree
                var model = new go.GraphLinksModel({ linkFromPortIdProperty: 'fromport' });
                makeNodes(model);
                makeLinks(model);
                myDiagram.model = model;

                // Initially hide all nodes except for the start node
                myDiagram.nodes.each((n) => {
                    if (n.data.key !== 'start') n.visible = false;
                });
                myDiagram.links.each((l) => {
                    l.visible = false;
                });
            }

            function makeNodes(model) {
                var nodeDataArray = [
                    { key: 'start', title: 'I am a:' },
                    { key: 'a', title: 'I have sex with:' },
                    { key: 'b', title: 'I have sex with:' },
                    { key: 'c', title: 'I have sex with:' },
                    { key: 'd', title: 'I have sex with:' },
                    { key: 'e', title: 'I have sex with:' },
                    { key: 'f', title: 'I have sex with:' },
                    { key: 'a1', title: 'What kind of sex do you have:' },
                    { key: 'b1', title: 'What kind of sex do you have:' },
                    { key: 'c1', title: 'What kind of sex do you have:' },
                    { key: 'd1', title: 'What kind of sex do you have:' },
                    { key: 'e1', title: 'What kind of sex do you have:' },
                    { key: 'f1', title: 'What kind of sex do you have:' },
                    { key: 'a21', title: 'How often do you or your partner/s wear a condom during sex?' },
                    { key: 'b21', title: 'How often do you or your partner/s wear a condom during sex?' },
                    { key: 'c21', title: 'How often do you or your partner/s wear a condom during sex?' },
                    { key: 'd21', title: 'How often do you or your partner/s wear a condom during sex?' },
                    { key: 'e21', title: 'How often do you or your partner/s wear a condom during sex?' }
                ];

                for (var i = 0; i < nodeDataArray.length; i++) {
                    var d = nodeDataArray[i];
                    if (d.key === 'start') {
                        d.category = 'decision';
                        d.a = 'a'; d.aText = 'Man';
                        d.b = 'b'; d.bText = 'Woman';
                        d.c = 'c'; d.cText = 'Transman';
                        d.d = 'd'; d.dText = 'Transwoman';
                        d.e = 'e'; d.eText = 'Non-binary person';
                        d.f = 'f'; d.fText = 'Other';
                    } else {
                        switch (d.key.length) {
                            case 1:
                                d.category = 'decision';
                                d.a = 'a1'; d.aText = 'Men';
                                d.b = 'b1'; d.bText = 'Women';
                                d.c = 'c1'; d.cText = 'Transmen';
                                d.d = 'd1'; d.dText = 'Transwomen';
                                d.e = 'e1'; d.eText = 'Non-binary people';
                                d.f = 'f1'; d.fText = 'Other';
                                break;
                            case 2:
                                d.category = 'decision';
                                d.a = 'a21'; d.aText = 'Never';
                                d.b = 'b21'; d.bText = 'Rarely';
                                d.c = 'c21'; d.cText = 'Sometimes';
                                d.d = 'd21'; d.dText = 'Often';
                                d.e = 'e21'; d.eText = 'Always';
                                d.f = 'f21'; d.fText = 'Not Applicable';
                                break;
                            default:
                                d.category = 'personality';
                                d.text = d.title; // Use title as the text for leaf nodes
                                break;
                        }
                    }
                }
                model.nodeDataArray = nodeDataArray;
            }

            function makeLinks(model) {
                var linkDataArray = [];

                // Define the number of options per block (e.g., 6 options per decision point)
                const options = ['a', 'b', 'c', 'd', 'e', 'f'];

                // Create links from 'start' to the first set of nodes (e.g., 'a', 'b', 'c', etc.)
                options.forEach(option => {
                    linkDataArray.push({ from: 'start', to: option, fromport: option });
                });

                // Create links for the second level (e.g., 'a1', 'b1', etc.)
                options.forEach(option => {
                    linkDataArray.push({ from: option, to: option + '1', fromport: option });
                });

                // Create links for the third level (e.g., 'a21', 'b21', etc.)
                options.forEach(option => {
                    linkDataArray.push({ from: option + '1', to: option + '21', fromport: option });
                });

                model.linkDataArray = linkDataArray;
            }

            function tooltipTextConverter(data) {
                return data.aText || data.bText || data.cText || data.dText || data.eText || data.fText;
            }

            window.addEventListener('DOMContentLoaded', init);
        </script>

        <div id="myDiagramDiv" style="border: solid 1px black; width: 800px; height: 600px"></div>
    </div>
</body>

</html>
